jobs:
    build:
        container: quay.io/skopeo/stable:latest
        continue-on-error: true
        runs-on: ubuntu-latest
        steps:
        -   name: checkout
            uses: actions/checkout@v2
        -   name: login
            run: for i in {1..5}; do skopeo login -u ${{ secrets.REGISTERY_USERNAME }} registry.cn-hangzhou.aliyuncs.com -p ${{ secrets.REGISTERY_PASSWORD }} || true; done
        -   name: perpare
            run: dnf install pip3 -y && pip3 install redis pyyaml tencentcloud-sdk-python-tcr
        -   name: sync
            run: REDIS_HOST=${{ secrets.REDIS_HOST }} REDIS_PASSWORD=${{ secrets.REDIS_PASSWORD }} SECRET_ID=${{ secrets.SECRET_ID }} SECRET_KEY=${{ secrets.SECRET_KEY }} python3 sync.py ${{ matrix.syncs }} -v
        strategy:
            matrix:
                syncs:
                - '"cgr.dev/chainguard/bash                                                                                     chainguard_bash"'
                - '"docker.elastic.co/elasticsearch/elasticsearch                                                               "'
                - '"docker.io/80imike/find-container-process                                                                    "'
                - '"docker.io/apache/apisix                                                                                     "'
                - '"docker.io/apache/rocketmq                                                                                   "'
                - '"docker.io/apache/rocketmq-exporter                                                                          "'
                - '"docker.io/apache/skywalking-swck                                                                            "'
                - '"docker.io/apachepulsar/pulsar-all                                                                           "'
                - '"docker.io/bitnami/jmx-exporter                                                                              "'
                - '"docker.io/bitnami/kubectl                                                                                   "'
                - '"docker.io/bitnami/mongodb                                                                                   "'
                - '"docker.io/bitnami/mongodb-exporter                                                                          "'
                - '"docker.io/bitnami/rabbitmq                                                                                  "'
                - '"docker.io/cilium/cilium                                                                                     "'
                - '"docker.io/cilium/hubble-relay                                                                               "'
                - '"docker.io/clickhouse/clickhouse-server                                                                      "'
                - '"docker.io/curlimages/curl                                                                                   "'
                - '"docker.io/docker/dockerfile                                                                                 "'
                - '"docker.io/envoyproxy/envoy                                                                                  envoyproxy-envoy"'
                - '"docker.io/flannel/flannel                                                                                   "'
                - '"docker.io/flannel/flannel-cni-plugin                                                                        "'
                - '"docker.io/flomesh/fsm-bootstrap                                                                             "'
                - '"docker.io/flomesh/fsm-controller                                                                            "'
                - '"docker.io/flomesh/fsm-curl                                                                                  "'
                - '"docker.io/flomesh/fsm-ingress                                                                               "'
                - '"docker.io/flomesh/fsm-injector                                                                              "'
                - '"docker.io/flomesh/fsm-preinstall                                                                            "'
                - '"docker.io/flomesh/fsm-sidecar-init                                                                          "'
                - '"docker.io/flomesh/pipy                                                                                      "'
                - '"docker.io/flomesh/pipy-repo                                                                                 "'
                - '"docker.io/fluent/fluent-bit                                                                                 "'
                - '"docker.io/frooodle/s-pdf                                                                                    "'
                - '"docker.io/goharbor/harbor-core                                                                              "'
                - '"docker.io/goharbor/harbor-db                                                                                "'
                - '"docker.io/goharbor/harbor-jobservice                                                                        "'
                - '"docker.io/goharbor/harbor-log                                                                               "'
                - '"docker.io/goharbor/harbor-portal                                                                            "'
                - '"docker.io/goharbor/harbor-registryctl                                                                       "'
                - '"docker.io/goharbor/nginx-photon                                                                             "'
                - '"docker.io/goharbor/prepare                                                                                  "'
                - '"docker.io/goharbor/redis-photon                                                                             "'
                - '"docker.io/goharbor/registry-photon                                                                          "'
                - '"docker.io/grafana/grafana                                                                                   "'
                - '"docker.io/grafana/loki                                                                                      "'
                - '"docker.io/istio/examples-bookinfo-details-v1                                                                "'
                - '"docker.io/istio/examples-bookinfo-details-v2                                                                "'
                - '"docker.io/istio/examples-bookinfo-mongodb                                                                   "'
                - '"docker.io/istio/examples-bookinfo-mysqldb                                                                   "'
                - '"docker.io/istio/examples-bookinfo-productpage-v1                                                            "'
                - '"docker.io/istio/examples-bookinfo-ratings-v1                                                                "'
                - '"docker.io/istio/examples-bookinfo-ratings-v2                                                                "'
                - '"docker.io/istio/examples-bookinfo-reviews-v1                                                                "'
                - '"docker.io/istio/examples-bookinfo-reviews-v2                                                                "'
                - '"docker.io/istio/examples-bookinfo-reviews-v3                                                                "'
                - '"docker.io/istio/examples-helloworld-v1                                                                      "'
                - '"docker.io/istio/examples-helloworld-v2                                                                      "'
                - '"docker.io/istio/health                                                                                      "'
                - '"docker.io/istio/install-cni                                                                                 "'
                - '"docker.io/istio/pilot                                                                                       "'
                - '"docker.io/istio/proxyv2                                                                                     "'
                - '"docker.io/istio/tcp-echo-server                                                                             "'
                - '"docker.io/istio/ztunnel                                                                                     "'
                - '"docker.io/jaegertracing/all-in-one                                                                          "'
                - '"docker.io/karmada/karmada-agent                                                                             "'
                - '"docker.io/karmada/karmada-aggregated-apiserver                                                              "'
                - '"docker.io/karmada/karmada-controller-manager                                                                "'
                - '"docker.io/karmada/karmada-descheduler                                                                       "'
                - '"docker.io/karmada/karmada-interpreter-webhook-example                                                       "'
                - '"docker.io/karmada/karmada-metrics-adapter                                                                   "'
                - '"docker.io/karmada/karmada-operator                                                                          "'
                - '"docker.io/karmada/karmada-scheduler                                                                         "'
                - '"docker.io/karmada/karmada-scheduler-estimator                                                               "'
                - '"docker.io/karmada/karmada-search                                                                            "'
                - '"docker.io/karmada/karmada-webhook                                                                           "'
                - '"docker.io/kindest/node                                                                                      "'
                - '"docker.io/kiwigrid/k8s-sidecar                                                                              "'
                - '"docker.io/kubeshark/front                                                                                   "'
                - '"docker.io/kubeshark/hub                                                                                     "'
                - '"docker.io/kubeshark/worker                                                                                  "'
                - '"docker.io/kubeskoop/agent                                                                                   "'
                - '"docker.io/kubeskoop/controller                                                                              kubeskoop_controller"'
                - '"docker.io/kubezoo/clusterresourcequota                                                                      "'
                - '"docker.io/kubezoo/kubezoo                                                                                   "'
                - '"docker.io/labring/calico                                                                                    labring_calico"'
                - '"docker.io/labring/flannel                                                                                   labring_flannel"'
                - '"docker.io/labring/helm                                                                                      labring_helm"'
                - '"docker.io/library/alpine                                                                                    "'
                - '"docker.io/library/buildpack-deps                                                                            "'
                - '"docker.io/library/busybox                                                                                   "'
                - '"docker.io/library/debian                                                                                    "'
                - '"docker.io/library/golang                                                                                    "'
                - '"docker.io/library/mysql                                                                                     "'
                - '"docker.io/library/nginx                                                                                     "'
                - '"docker.io/library/postgres                                                                                  "'
                - '"docker.io/library/python                                                                                    "'
                - '"docker.io/library/redis                                                                                     "'
                - '"docker.io/library/registry                                                                                  "'
                - '"docker.io/library/ubuntu                                                                                    "'
                - '"docker.io/loftsh/vcluster                                                                                   "'
                - '"docker.io/mccutchen/go-httpbin                                                                              "'
                - '"docker.io/meltwater/latency-test                                                                            "'
                - '"docker.io/mingrammer/flog                                                                                   "'
                - '"docker.io/moby/buildkit                                                                                     "'
                - '"docker.io/mydlqclub/dnsutils                                                                                "'
                - '"docker.io/opensearchproject/opensearch                                                                      "'
                - '"docker.io/opensearchproject/opensearch-dashboards                                                           "'
                - '"docker.io/otel/opentelemetry-collector                                                                      "'
                - '"docker.io/pivotalrabbitmq/perf-test                                                                         "'
                - '"docker.io/projecthami/hami                                                                                  "'
                - '"docker.io/prom/mysqld-exporter                                                                              "'
                - '"docker.io/prom/prometheus                                                                                   "'
                - '"docker.io/prometheuscommunity/postgres-exporter                                                             "'
                - '"docker.io/rancher/k3s                                                                                       "'
                - '"docker.io/rayproject/ray                                                                                    "'
                - '"docker.io/redroid/redroid                                                                                   "'
                - '"docker.io/rmohr/activemq                                                                                    "'
                - '"docker.io/tinygo/tinygo                                                                                     "'
                - '"docker.io/traefik/whoami                                                                                    "'
                - '"docker.io/vllm/vllm-openai                                                                                  "'
                - '"docker.io/volcanosh/dist-mnist-tf-example                                                                   "'
                - '"docker.io/volcanosh/vc-controller-manager                                                                   "'
                - '"docker.io/volcanosh/vc-scheduler                                                                            "'
                - '"docker.io/volcanosh/vc-webhook-manager                                                                      "'
                - '"docker.io/wagoodman/dive                                                                                    "'
                - '"docker.io/yunwei37/ebpm                                                                                     "'
                - '"gcr.io/google-samples/microservices-demo/adservice                                                          microservices-demo-adservice"'
                - '"gcr.io/google-samples/microservices-demo/cartservice                                                        microservices-demo-cartservice"'
                - '"gcr.io/google-samples/microservices-demo/checkoutservice                                                    microservices-demo-checkoutservice"'
                - '"gcr.io/google-samples/microservices-demo/currencyservice                                                    microservices-demo-currencyservice"'
                - '"gcr.io/google-samples/microservices-demo/emailservice                                                       microservices-demo-emailservice"'
                - '"gcr.io/google-samples/microservices-demo/frontend                                                           microservices-demo-frontend"'
                - '"gcr.io/google-samples/microservices-demo/loadgenerator                                                      microservices-demo-loadgenerator"'
                - '"gcr.io/google-samples/microservices-demo/paymentservice                                                     microservices-demo-paymentservice"'
                - '"gcr.io/google-samples/microservices-demo/productcatalogservice                                              microservices-demo-productcatalogservice"'
                - '"gcr.io/google-samples/microservices-demo/recommendationservice                                              microservices-demo-recommendationservice"'
                - '"gcr.io/google-samples/microservices-demo/shippingservice                                                    microservices-demo-shippingservice"'
                - '"gcr.io/heptio-images/ks-guestbook-demo                                                                      "'
                - '"gcr.io/knative-releases/knative.dev/net-istio/cmd/controller                                                net-istio-controller"'
                - '"gcr.io/knative-releases/knative.dev/net-istio/cmd/webhook                                                   net-istio-webhook"'
                - '"gcr.io/knative-releases/knative.dev/net-kourier/cmd/kourier                                                 net-kourier-kourier"'
                - '"gcr.io/knative-releases/knative.dev/serving/cmd/activator                                                   knative-serving-activator"'
                - '"gcr.io/knative-releases/knative.dev/serving/cmd/autoscaler                                                  knative-serving-autoscaler"'
                - '"gcr.io/knative-releases/knative.dev/serving/cmd/autoscaler-hpa                                              knative-serving-autoscaler-hpa"'
                - '"gcr.io/knative-releases/knative.dev/serving/cmd/controller                                                  knative-serving-controller"'
                - '"gcr.io/knative-releases/knative.dev/serving/cmd/default-domain                                              knative-serving-default-domain"'
                - '"gcr.io/knative-releases/knative.dev/serving/cmd/queue                                                       knative-serving-queue"'
                - '"gcr.io/knative-releases/knative.dev/serving/cmd/webhook                                                     knative-serving-webhook"'
                - '"gcr.io/kubebuilder/kube-rbac-proxy                                                                          "'
                - '"ghcr.io/apache/skywalking-cli/skywalking-cli                                                                "'
                - '"ghcr.io/apache/skywalking-kubernetes-event-exporter/skywalking-kubernetes-event-exporter                    "'
                - '"ghcr.io/apache/skywalking-rover/skywalking-rover                                                            "'
                - '"ghcr.io/apache/skywalking-satellite/skywalking-satellite                                                    "'
                - '"ghcr.io/apache/skywalking-showcase/app                                                                      "'
                - '"ghcr.io/apache/skywalking-showcase/frontend                                                                 "'
                - '"ghcr.io/apache/skywalking-showcase/gateway-service                                                          "'
                - '"ghcr.io/apache/skywalking-showcase/load-gen                                                                 "'
                - '"ghcr.io/apache/skywalking-showcase/rating-service                                                           "'
                - '"ghcr.io/apache/skywalking-showcase/recommendation-service                                                   "'
                - '"ghcr.io/apache/skywalking-showcase/songs-service                                                            "'
                - '"ghcr.io/apache/skywalking/oap                                                                               "'
                - '"ghcr.io/apache/skywalking/ui                                                                                "'
                - '"ghcr.io/dexidp/dex                                                                                          "'
                - '"ghcr.io/eunomia-bpf/ecc-x86_64                                                                              "'
                - '"ghcr.io/fluxcd/flagger                                                                                      "'
                - '"ghcr.io/fluxcd/flagger-loadtester                                                                           "'
                - '"ghcr.io/k-cloud-labs/kinitiras-webhook                                                                      "'
                - '"ghcr.io/prometheus-operator/prometheus-config-reloader                                                      "'
                - '"ghcr.io/skyapm/r3                                                                                           "'
                - '"ghcr.io/stefanprodan/podinfo                                                                                "'
                - '"k8s.gcr.io/sig-storage/csi-attacher                                                                         "'
                - '"k8s.gcr.io/sig-storage/csi-node-driver-registrar                                                            "'
                - '"k8s.gcr.io/sig-storage/csi-provisioner                                                                      "'
                - '"k8s.gcr.io/sig-storage/csi-resizer                                                                          "'
                - '"k8s.gcr.io/sig-storage/csi-snapshotter                                                                      "'
                - '"public.ecr.aws/zinclabs/openobserve                                                                         "'
                - '"quay.io/argoproj/argocd                                                                                     "'
                - '"quay.io/centos/centos                                                                                       "'
                - '"quay.io/cephcsi/cephcsi                                                                                     "'
                - '"quay.io/cilium/certgen                                                                                      "'
                - '"quay.io/cilium/cilium-ci                                                                                    "'
                - '"quay.io/cilium/cilium-envoy                                                                                 "'
                - '"quay.io/cilium/hubble-export-stdout                                                                         "'
                - '"quay.io/cilium/hubble-ui                                                                                    "'
                - '"quay.io/cilium/hubble-ui-backend                                                                            "'
                - '"quay.io/cilium/operator                                                                                     "'
                - '"quay.io/cilium/operator-generic                                                                             "'
                - '"quay.io/cilium/startup-script                                                                               "'
                - '"quay.io/cilium/tetragon                                                                                     "'
                - '"quay.io/cilium/tetragon-operator                                                                            "'
                - '"quay.io/frrouting/frr                                                                                       "'
                - '"quay.io/jetstack/cert-manager-controller                                                                    "'
                - '"quay.io/jetstack/cert-manager-ctl                                                                           "'
                - '"quay.io/jetstack/cert-manager-webhook                                                                       "'
                - '"quay.io/kuberay/operator                                                                                    kuberay_operator"'
                - '"quay.io/metallb/controller                                                                                  metallb_controller"'
                - '"quay.io/metallb/frr-k8s                                                                                     metallb_frr-k8s"'
                - '"quay.io/metallb/speaker                                                                                     metallb_speaker"'
                - '"quay.io/prometheus/node-exporter                                                                            "'
                - '"quay.io/prometheuscommunity/elasticsearch-exporter                                                          "'
                - '"quay.io/submariner/lighthouse-agent                                                                         "'
                - '"quay.io/submariner/lighthouse-coredns                                                                       "'
                - '"quay.io/submariner/nettest                                                                                  "'
                - '"quay.io/submariner/submariner-gateway                                                                       "'
                - '"quay.io/submariner/submariner-operator                                                                      "'
                - '"quay.io/submariner/submariner-route-agent                                                                   "'
                - '"registry.k8s.io/e2e-test-images/agnhost                                                                     e2e-test-images-agnhost"'
                - '"registry.k8s.io/etcd                                                                                        "'
                - '"registry.k8s.io/kube-apiserver                                                                              "'
                - '"registry.k8s.io/kube-controller-manager                                                                     "'
                - '"registry.k8s.io/kube-state-metrics/kube-state-metrics                                                       "'
                - '"registry.k8s.io/lws/lws                                                                                     "'
                - '"registry.k8s.io/metrics-server/metrics-server                                                               "'
                - '"skywalking.docker.scarf.sh/apache/skywalking-oap-server                                                     "'
                - '"skywalking.docker.scarf.sh/apache/skywalking-ui                                                             "'
                - '"us-central1-docker.pkg.dev/google-samples/microservices-demo/adservice                                      microservices-demo-adservice"'
                - '"us-central1-docker.pkg.dev/google-samples/microservices-demo/cartservice                                    microservices-demo-cartservice"'
                - '"us-central1-docker.pkg.dev/google-samples/microservices-demo/checkoutservice                                microservices-demo-checkoutservice"'
                - '"us-central1-docker.pkg.dev/google-samples/microservices-demo/currencyservice                                microservices-demo-currencyservice"'
                - '"us-central1-docker.pkg.dev/google-samples/microservices-demo/emailservice                                   microservices-demo-emailservice"'
                - '"us-central1-docker.pkg.dev/google-samples/microservices-demo/frontend                                       microservices-demo-frontend"'
                - '"us-central1-docker.pkg.dev/google-samples/microservices-demo/loadgenerator                                  microservices-demo-loadgenerator"'
                - '"us-central1-docker.pkg.dev/google-samples/microservices-demo/paymentservice                                 microservices-demo-paymentservice"'
                - '"us-central1-docker.pkg.dev/google-samples/microservices-demo/productcatalogservice                          microservices-demo-productcatalogservice"'
                - '"us-central1-docker.pkg.dev/google-samples/microservices-demo/recommendationservice                          microservices-demo-recommendationservice"'
                - '"us-central1-docker.pkg.dev/google-samples/microservices-demo/shippingservice                                microservices-demo-shippingservice"'
                - '"us-central1-docker.pkg.dev/k8s-staging-images/kueue/kueueviz-backend                                        "'
                - '"us-central1-docker.pkg.dev/k8s-staging-images/kueue/kueueviz-frontend                                       "'
            max-parallel: 100
name: sync
'on':
    pull_request:
        branches:
        - main
    push:
        branches:
        - main
    schedule:
    -   cron: 0 */2 * * *
